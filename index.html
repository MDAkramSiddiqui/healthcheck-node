<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/jquery.js"></script>
</head>
<body>
  
  <h1 onclick="getHealthCheckReport()">HealthCheck</h1>
  <ul class="report"></ul>


  <script>
    const server = "http://localhost:5000";

    function getHealthCheckReport() {
      console.log('Hello Healthcheck');

      // const result = [
      //   {
      //     service: 'msyql',
      //     status: 'OK',
      //     time: 199
      //   },
      //   {
      //     service: 'redis',
      //     status: 'CRIT',
      //     time: 20
      //   },
      //   {
      //     requestCounter: 125
      //   }
      // ];

      $.ajax({
        url: server + "/healthcheck",
        method: "GET",
        success: function(response) {
          console.log(response);

          //parse JSON to JS object and putting them into html document
          var unorderedList = document.getElementById("messages");
          // var result = JSON.parse(response);
          var result = response;
          console.log(response);

          const list = document.querySelector('.report');
          list.innerHTML = '';

          for(s of result) {

            if(s.status === 'OK') {
              var li = document.createElement("li");
              li.innerHTML = `
              <ul class="primary">
                <li class="li-heading">${s.service} </li>
                <li>Status: ${s.status} </li>
                <li>Message: ${s.message} </li>
                <li>Time: ${s.time} ms</li>
              </ul>
              `;
              list.appendChild(li);

            }else if(s.status === 'CRIT') {
              var li = document.createElement("li");
              li.innerHTML = `
              <ul class="danger">
                <li class="li-heading">${s.service} </li>
                <li>Status: ${s.status} </li>
                <li>Message: ${s.message} </li>
                <li>Time: ${s.time} ms</li>
              </ul>
              `;
              list.appendChild(li);

            }else {
              var li = document.createElement("li");
              li.innerHTML = `
              <ul class="primary">
                <li class="counter">Request: ${s.requestCounter} </li>
              </ul>
              `;
              list.appendChild(li);
            }
          }


        }
      });

      

      /*
      $.ajax({
        url: server + "/healthcheck",
        method: "GET",
        success: function(response) {
          console.log(response);

          //parse JSON to JS object and putting them into html document
          var unorderedList = document.getElementById("messages");
          var data = JSON.parse(response);
          console.log(response);
          
          for(var a=0; a<data.length; a++) {

            // displaying messages
            var li = document.createElement("li");
            li.innerHTML = data[a].message;
            unorderedList.appendChild(li);
          }
        }
      });
      */
    }

  </script>
</body>
</html>